<!-- File: Index.html (User app) -->
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="referrer" content="same-origin" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <meta name="autocomplete" content="off">
  <title>Minimal Member App</title>
  <link rel="preconnect" href="https://quickchart.io">
  <style>
    :root{
      --mx: 940px;
      --pad: 16px;
      --gap: 12px;
      --ring: 1px solid #e5e7eb;
      --muted: #5f6b7a;
      --bg-soft: #fafafa;
      --bg-page: #ffffff;
      --radius: 10px;
      --shadow: 0 1px 2px rgba(0,0,0,.06), 0 6px 24px rgba(0,0,0,.06);
      --font: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }

    * , *::before , *::after { box-sizing: border-box; }
    html , body { height: 100%; }
    html { overflow-x: hidden; }
    body {
      font-family: var(--font);
      font-size: 15px;
      margin: 0;
      background: var(--bg-page);
      color: #0f172a;
      line-height: 1.45;
      overflow-x: clip;
      -webkit-text-size-adjust: 100%;
      text-size-adjust: 100%;
    }

    /* layout */
    .container{
      max-width: var(--mx);
      width: min(100%, var(--mx));
      margin-left: auto;
      margin-right: auto;
      padding-top: 20px;
      padding-bottom: 56px;
      padding-left: max(var(--pad), env(safe-area-inset-left, 0px) + 12px);
      padding-right: max(var(--pad), env(safe-area-inset-right, 0px) + 12px);
      contain: inline-size;
      display: grid;
      gap: var(--gap);
    }
    .container{ padding-inline: 16px; }
    @supports (padding: max(0px)){
      .container{
        padding-inline-start: max(16px, calc(env(safe-area-inset-left, 0px) + 12px));
        padding-inline-end:   max(16px, calc(env(safe-area-inset-right, 0px) + 12px));
      }
    }
    .stack{ display: grid; gap: var(--gap); }
    .inline{ display: grid; gap: 10px; grid-template-columns: 1fr; }
    .btns{ display: grid; gap: 8px; grid-auto-flow: row; }
    .right { margin-left: auto; }

    /* cards */
    .card{
      background: #fff;
      border: var(--ring);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 12px;
    }

    /* headings and text */
    h1, h2, h3, h4 { margin: 0 0 8px; line-height: 1.2; }
    h2 { font-size: 20px; }
    h3 { font-size: 17px; }
    p  { margin: 8px 0 12px; }
    .muted{ color: var(--muted); }
    :where(p, small, li, td, th, button, input, label, code){
      overflow-wrap: anywhere;
      word-break: break-word;
    }

    /* controls */
    input, button, select {
      padding: 8px 10px;
      margin: 4px 0;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      font: inherit;
      font-size: 16px; /* stop iOS focus zoom */
    }

    input, select { width: 100%; }
    button{
      background: #0ea5e9;
      color: #fff;
      border: 0;
      cursor: pointer;
    }
    button:hover{ filter: brightness(.98); }
    button:disabled{ opacity:.6; cursor:not-allowed; }

    /* small screens tune */
    @media (max-width: 360px){
      .card{ padding: 10px; }
      body{ font-size: 14px; }
      button{ padding: 5px 9px; font-size: .9em; }
    }

    /* center certain main panels like Merchant */
    #view-member{ display: grid; justify-items: center; font-size: .95em; }
    #view-member .card{ width: min(100%, 920px); margin-inline: auto; max-width: 100%; }

    /* tables with responsive stack mode */
    .table-wrap{
      border: var(--ring);
      border-radius: 10px;
      overflow: hidden;
      background: #fff;
      contain: content;
    }
    .table-scroll{ overflow-x: auto; -webkit-overflow-scrolling: touch; }
    table{ border-collapse: collapse; width: 100%; min-width: 0; }
    th, td{ border-top: 1px solid #f1f5f9; padding: 7px 9px; font-size: 12.5px; vertical-align: top; }
    thead th{ background: #f8fafc; text-align: left; position: sticky; top: 0; }
    td.num, th.num { text-align: right; }

    @media (max-width: 640px){
      .table-scroll{ overflow: visible; }
      table{ display: block; }
      thead{ display: none; }
      tbody{ display: grid; gap: 10px; }
      tbody tr{
        display: grid;
        gap: 6px;
        padding: 10px;
        border: 1px solid #f1f5f9;
        border-radius: 10px;
        background: #fff;
      }
      tbody td{ display: grid; gap: 2px; }
      tbody td::before{
        content: attr(data-label);
        font-weight: 600;
        color: var(--muted);
      }
      tbody td.num{ justify-items: end; }
    }

    /* banners and toasts */
    #app-banner{ position: sticky; top: 0; z-index: 1000; margin-bottom: 12px; }
    .banner{ border:1px solid transparent; padding:10px 12px; border-radius:10px; display:grid; grid-template-columns:auto 1fr auto; align-items:start; gap:8px; }
    .banner-info    { background:#f0f6ff; border-color:#cfe3ff; }
    .banner-success { background:#edf9f0; border-color:#cdeed8; }
    .banner-error   { background:#fff0f0; border-color:#ffd6d6; }
    .banner strong { min-width:64px; }
    .banner button.close{ background:transparent; border:0; cursor:pointer; font-size:14px; }

    #toast-container{ position: fixed; right: 16px; bottom: 16px; z-index: 1001; display: grid; gap: 8px; max-width: 360px; }
    .toast{ padding: 10px 12px; border: 1px solid transparent; border-radius: 10px; background: #edf9f0; box-shadow: 0 2px 12px rgba(0,0,0,.12); }
    .toast.info{ background: #f0f6ff; }
    .toast.error{ background: #fff0f0; }
    .toast .close{ background: transparent; border: 0; cursor: pointer; float: right; }

    /* existing QR styles kept verbatim but scoped inside a card */
    .qr-wrap { position: relative; width:200px; height:200px; background:#f2f2f2; display:block; }
    #my-qr { width:100%; height:100%; display:block; }
    .spinner { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; font-size:12px; }
    .qr-wrap.loading .spinner { display:flex; }
    .qr-wrap:not(.loading) .spinner { display:none; }

    /* wizard header visual */
    details > summary {
      pointer-events: none;
      user-select: none;
      background: #fafafa;
      padding: 6px 8px;
      border: 1px solid #eee;
      border-radius: 4px;
    }

    /* modal */
    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,.45); display: none; align-items: center; justify-content: center; z-index: 9999; }
    .modal-overlay.show { display: flex; }
    .modal-card { width: min(480px, 92vw); background: #fff; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,.2); padding: 18px 16px; position: relative; }
    .modal-card h2 { margin: 0 0 6px; }
    .modal-card p.muted { color:#666; margin: 0 0 12px; }
    .modal-close { position:absolute; top:8px; right:8px; background:transparent; border:none; font-size:20px; cursor:pointer; }

    .hidden { display: none !important; }

    @media(min-width: 960px){
      .inline{ grid-template-columns: 1fr 1fr; }
      .btns{ grid-auto-flow: column; justify-content: start; }
    }

    html, body{
      overflow-x: hidden;
      overscroll-behavior-x: none;
      touch-action: pan-y pinch-zoom;
    }

    /* ensure wide children cannot create horizontal scrolling */
    .table-wrap,
    .table-scroll,
    #view-member,
    #view-member .card{
      max-width: 100%;
      overflow-x: hidden;
    }

  #btn-logout { display: none; }
</style>
</head>
<body>
  <div class="container">

    <div id="app-banner" aria-live="polite" role="status"></div>
    <div id="toast-container" aria-live="polite"></div>

    <!-- Loading -->
    <section id="view-loading" class="card"><p>Loading…</p></section>

    <!-- Home -->
    <section id="view-home" class="hidden card stack">
      <h1>Home</h1>
      <div class="btns">
        <button id="btn-go-signup">Sign Up</button>
        <button id="btn-go-signin">Sign In</button>
        <button id="btn-open-waitlist-home" type="button">Join Waitlist</button>
      </div>
    </section>

    <!-- Sign Up -->
    <section id="view-signup" class="hidden card stack">
      <h1>Sign Up</h1>

      <details id="su-step1" open>
        <summary><b>Personal Information</b></summary>
        <form id="form-su-1" class="stack" novalidate autocomplete="off">
          <label>First name<br><input id="su-first" required autocomplete="off"></label>
          <label>Last name<br><input id="su-last" required autocomplete="off"></label>
          <label>Birthdate<br><input id="su-birth" type="date" required autocomplete="off"></label>
          <label>Gender<br>
            <select id="su-gender" required autocomplete="off">
              <option value="">—</option>
              <option value="female">Female</option>
              <option value="male">Male</option>
            </select>
          </label>
          <label>City optional<br><input id="su-city" autocomplete="off"></label>
          <label>Main page language optional<br>
            <select id="su-lang" autocomplete="off">
              <option value="en">English</option>
              <option value="ar">Arabic</option>
            </select>
          </label>
          <div class="muted" id="su1-msg"></div>
          <div class="btns">
            <button type="submit" id="su1-next" class="right">Next</button>
            <button type="button" id="su1-cancel">Cancel</button>
          </div>
        </form>
      </details>

      <details id="su-step2">
        <summary><b>Contact and Preferences</b></summary>
        <form id="form-su-2" class="stack" novalidate autocomplete="off">
          <label>Email<br><input id="su-email" type="email" required autocomplete="off"></label>

          <label>Phone Lebanon
            <div class="inline" style="grid-template-columns:auto 1fr; align-items:center;">
              <span style="background:#f5f5f5;border:1px solid #ddd;padding:6px 8px;border-radius:4px;user-select:none;">+961</span>
              <input id="su-phone8" inputmode="numeric" pattern="[0-9]{7,8}" maxlength="8" placeholder="8 digits or 7 if starts with 3" required autocomplete="off">
            </div>
            <small class="muted">Only Lebanese numbers. Exactly 8 digits.</small>
          </label>

          <label>WhatsApp optional
            <div class="inline" style="grid-template-columns:auto 1fr; align-items:center;">
              <span id="su-wa-prefix" style="background:#f5f5f5;border:1px solid #ddd;padding:6px 8px;border-radius:4px;color:#aaa;user-select:none;">+961</span>
              <input id="su-wa8" inputmode="numeric" pattern="[0-9]{0,8}" maxlength="8" placeholder="optional 8 digits" autocomplete="off">
            </div>
          </label>

          <label>Preferred communication method<br>
            <select id="su-pref" required autocomplete="off">
              <option value="">—</option>
              <option value="email">Email</option>
              <option value="sms">SMS</option>
              <option value="whatsapp">WhatsApp</option>
            </select>
          </label>

          <label>Marketing opt in
            <input type="checkbox" id="su-optin"> I agree to receive offers
          </label>

          <label>Referral code optional<br><input id="su-referral" autocomplete="off"></label>

          <div class="muted" id="su2-msg"></div>
          <div class="btns">
            <button type="submit" id="su2-next" class="right">Next</button>
            <button type="button" id="su2-back">Back</button>
            <button type="button" id="su2-cancel">Cancel</button>
          </div>
        </form>
      </details>

      <details id="su-step3">
        <summary><b>Security and Legal</b></summary>
        <form id="form-su-3" class="stack" novalidate autocomplete="off">
          <label>Six digit PIN<br><input id="su-pin1" type="password" maxlength="6" pattern="[0-9]{6}" inputmode="numeric" required autocomplete="new-password"></label>
          <label>Confirm PIN<br><input id="su-pin2" type="password" maxlength="6" pattern="[0-9]{6}" inputmode="numeric" required autocomplete="new-password"></label>
          <label>
            <input type="checkbox" id="su-legal" required>
            I agree to the Privacy Policy and Terms and Conditions.
          </label>
          <div class="muted" id="su3-msg"></div>
          <div class="btns">
            <button type="submit" id="su3-submit" class="right">Submit and Send OTP</button>
            <button type="button" id="su3-back">Back</button>
            <button type="button" id="su3-cancel">Cancel</button>
          </div>
        </form>
      </details>

      <details id="su-step-otp" class="hidden">
        <summary><b>Verify OTP</b></summary>
        <form id="form-su-otp" class="stack" novalidate autocomplete="off">
          <p class="muted">We sent a six digit code. It is valid for fifteen minutes.</p>
          <label>OTP<br><input id="su-otp" inputmode="numeric" maxlength="6" pattern="[0-9]{6}" required autocomplete="one-time-code"></label>
          <div class="muted" id="suotp-msg"></div>
          <div class="btns">
            <button type="submit" id="suotp-submit" class="right">Verify</button>
            <button type="button" id="suotp-back">Back</button>
            <button type="button" id="suotp-resend">Resend</button>
            <button type="button" id="suotp-cancel">Cancel</button>
          </div>
        </form>
      </details>
    </section>

    <!-- Sign In -->
    <section id="view-signin" class="hidden card stack">
      <h1>Sign In</h1>
      <form id="form-signin" class="stack" novalidate>
        <label>Email<br><input type="email" id="si-email" required /></label>
        <label>Six digit PIN<br><input type="password" id="si-pin" maxlength="6" pattern="[0-9]{6}" inputmode="numeric" autocomplete="one-time-code" required /></label>
        <div class="btns">
          <button type="submit" class="right">Sign In</button>
          <button type="button" id="btn-si-cancel">Cancel</button>
        </div>
        <div class="inline" style="grid-template-columns:1fr 1fr;">
          <button id="btn-forgot" type="button">Forgot PIN</button>
          <button id="btn-magic" type="button">Email me a magic link</button>
        </div>
        <div id="ml-msg" class="muted"></div>
      </form>
      <div id="si-msg" class="muted"></div>
      <div id="si-lock" class="muted" style="color:#555;"></div>
      <div id="si-countdown" class="muted" style="color:#555;"></div>
    </section>

    <!-- Reset Request -->
    <section id="view-reset-request" class="hidden card stack">
      <h1>Reset PIN</h1>
      <p>Enter your account email and we will generate a thirty minute reset link.</p>
      <form id="form-reset-req" class="stack" novalidate>
        <label>Email<br><input type="email" id="fr-email" required /></label>
        <div class="btns">
          <button type="submit" class="right">Send Link</button>
          <button type="button" id="fr-cancel">Cancel</button>
        </div>
      </form>
      <div id="fr-msg" class="muted"></div>
    </section>

    <!-- Reset Complete -->
    <section id="view-reset-complete" class="hidden card stack">
      <h1>Set New PIN</h1>
      <p id="rc-email" class="muted">—</p>
      <form id="form-reset-complete" class="stack" novalidate>
        <label>New six digit PIN<br><input type="password" id="rc-pin1" maxlength="6" pattern="[0-9]{6}" inputmode="numeric" required /></label>
        <label>Confirm PIN<br><input type="password" id="rc-pin2" maxlength="6" pattern="[0-9]{6}" inputmode="numeric" required /></label>
        <div class="btns">
          <button type="submit" class="right">Set PIN</button>
          <button type="button" id="rc-cancel">Cancel</button>
        </div>
      </form>
      <div id="rc-msg" class="muted"></div>
    </section>

    <!-- Member -->
    <section id="view-member" class="hidden stack">
      <div class="card stack">
        <h1>Member</h1>
        <p id="member-id">Member ID: —</p>

        <div class="inline">
          <div class="card stack">
            <h3>My QR</h3>
            <div id="qr-wrap" class="qr-wrap loading">
              <img id="my-qr" alt="My QR" />
              <div class="spinner">refreshing…</div>
            </div>
            <div id="qr-msg" class="muted"></div>
          </div>
          <div class="card stack">
            <h3>My Summary</h3>
            <p>
              Balance: <b id="balance-val">—</b> pts
              <button id="btn-refresh-summary" type="button" style="margin-left:8px;">Refresh</button>
              <label style="margin-left:12px;">
                Range
                <select id="summary-range">
                  <option value="5">Last 5</option>
                  <option value="30">30 days</option>
                  <option value="60">60 days</option>
                  <option value="90">90 days</option>
                  <option value="180">180 days</option>
                  <option value="365">1 year</option>
                </select>
              </label>
            </p>

            <div class="table-wrap">
              <div class="table-scroll">
                <table id="tbl-recent">
                  <thead>
                    <tr>
                      <th>When</th>
                      <th>Merchant Name</th>
                      <th>Type</th>
                      <th class="num">Points</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>

            <div id="summary-msg" class="muted"></div>
          </div>
          </div>
          <div class="card stack">
            <h3>Active Campaigns</h3>
            <div id="campaign-list" class="stack">
              <p id="campaign-msg" class="muted">Loading campaigns...</p>
            </div>
          </div>
          <div class="card stack">
            <h3>My Coupons</h3>
            <div id="coupon-list" class="stack">
              <p id="coupon-msg" class="muted">Loading coupons...</p>
            </div>
          </div>
          </div>          
        </div>

        <div class="card" role="note" aria-live="polite">
          <p class="muted" style="margin:0;">
            Points are collected and redeemed <b>by merchant staff</b> scanning your QR. Customer self-entry is disabled.
          </p>
        </div>

        <div class="btns" style="justify-content:end;">
          <button id="btn-logout" type="button">Log Out</button>
        </div>
        <div id="inact-msg" class="muted"></div>
        <div id="session-timer" class="muted" style="color:#555;">Session: —</div>
      </div>
    </section>

    <section id="view-welcome" class="hidden card stack">
      <h1>Welcome</h1>
      <p id="su-done-text">Welcome. Member ID: —</p>
      <div class="btns">
        <button id="su-done-next" class="right">Go to Member</button>
      </div>
    </section>

    <footer id="app-footer" class="muted" style="margin-top:8px;font-size:12px;text-align:right;">
      <span>Cashbeik member app</span>
      <span aria-hidden="true"> • </span>
      <span>version <?= appVersion ?></span>
    </footer>


    <!-- Waitlist Modal -->
    <div id="waitlist-overlay" class="modal-overlay" aria-hidden="true">
      <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="wl-title">
        <button id="wl-close" class="modal-close" aria-label="Close">&times;</button>
        <h2 id="wl-title">Join the Waitlist</h2>
        <p class="muted">Leave your details and we will notify you when we launch.</p>

        <form id="form-waitlist" class="stack" novalidate autocomplete="off">
          <label>Full name<br><input id="wl-name" required autocomplete="name"></label>
          <label>Email<br><input id="wl-email" type="email" required autocomplete="email"></label>
          <label>Phone Lebanon optional
            <div class="inline" style="grid-template-columns:auto 1fr; align-items:center;">
              <span style="background:#f5f5f5;border:1px solid #ddd;padding:6px 8px;border-radius:4px;user-select:none;">+961</span>
              <input id="wl-phone8" inputmode="numeric" pattern="[0-9]{0,8}" maxlength="8" placeholder="8 digits or 7 if starts with 3" autocomplete="tel">
            </div>
          </label>
          <label>Notes optional<br><input id="wl-notes" maxlength="140" placeholder="Anything you would like to add"></label>
          <input type="hidden" id="wl-city">
          <input type="hidden" id="wl-country">
          <div id="wl-msg" class="muted"></div>
          <div class="btns">
            <button type="submit" id="wl-submit" class="right">Join</button>
            <button type="button" id="wl-cancel">Cancel</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    const APP_VERSION = '<?= appVersion ?>';

    /* layout helper for responsive table labels */
    function applyResponsiveLabels_(table){
      if (!table || !table.tHead) return;
      const headers = Array.from(table.tHead.querySelectorAll('th')).map(th => th.textContent.trim());
      const rows = table.tBodies[0] ? Array.from(table.tBodies[0].rows) : [];
      rows.forEach(tr => {
        Array.from(tr.cells).forEach((td, i) => {
          const label = headers[i] || '';
          if (label && td.getAttribute('data-label') !== label) {
            td.setAttribute('data-label', label);
          }
        });
      });
    }
    function enableAutoLabeling_(){
      const all = document.querySelectorAll('table');
      all.forEach(applyResponsiveLabels_);
      const obs = new MutationObserver(muts => {
        const seen = new Set();
        muts.forEach(m => {
          const t = m.target && m.target.closest ? m.target.closest('table') : null;
          if (t && !seen.has(t)) { seen.add(t); applyResponsiveLabels_(t); }
        });
      });
      document.querySelectorAll('table tbody').forEach(tb => {
        obs.observe(tb, { childList: true, subtree: true });
      });
    }

    /* viewport normalizer, same behavior as merchant */
    function normalizeViewport(){
      const meta = document.querySelector('meta[name="viewport"]');
      if (!meta) return;

      const original = meta.getAttribute('content') || 'width=device-width, initial-scale=1, viewport-fit=cover';
      const forced   = 'width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover';
      meta.setAttribute('content', forced);

      const zeroX = () => {
        if (document.scrollingElement) document.scrollingElement.scrollLeft = 0;
        if (window.scrollX !== 0) window.scrollTo(0, window.scrollY);
      };
      zeroX();

      const vv = window.visualViewport || null;
      let tries = 0;
      const done = () => {
        meta.setAttribute('content', original.includes('initial-scale=1') ? original : (original + ', initial-scale=1'));
        zeroX();
      };
      const tick = () => {
        tries += 1;
        zeroX();
        const ok = !vv || Math.abs((vv.scale || 1) - 1) < 0.01 || tries > 8;
        if (ok) { setTimeout(done, 50); } else { requestAnimationFrame(tick); }
      };
      requestAnimationFrame(tick);
    }

    /* hard lock horizontal scroll like merchant */
    (function lockHorizontal(){
      const el = document.scrollingElement || document.documentElement;
      const fix = () => {
        if (el.scrollLeft !== 0) el.scrollLeft = 0;
        if (window.scrollX !== 0) window.scrollTo(0, window.scrollY);
      };
      window.addEventListener('scroll', fix, { passive: true });
      window.addEventListener('resize', fix, { passive: true });
    })();

    /* client error reporter to Admin logs, user app scope */
    function reportClientError_(message, stack, extra){
      try{
        const payload = {
          ua: navigator.userAgent || '',
          location: location.href || '',
          message: String(message || ''),
          stack: String(stack || ''),
          version: APP_VERSION || '',
          extra: extra || null
        };
        (function boot(){
  function finishLoading() {
    try { var loader = document.getElementById('loader'); if (loader) loader.style.display = 'none'; } catch(_) {}
  }
  var sid = null; try { sid = localStorage && localStorage.getItem('sid'); } catch(_) {}
  if (!sid) {
    finishLoading();
    var lo = document.getElementById('btn-logout'); if (lo) lo.style.display = 'none';
    show('signin');
    return;
  }
  finishLoading();
  google.script.run
    .withSuccessHandler(function (res) {
      if (res && res.ok) {
        try { if (res.sid) localStorage.setItem('sid', res.sid); } catch(_) {}
        var lo = document.getElementById('btn-logout'); if (lo) lo.style.display = 'inline-block';
        navigateGuarded_('member');
      } else {
        try { localStorage.removeItem('sid'); } catch(_) {}
        var lo = document.getElementById('btn-logout'); if (lo) lo.style.display = 'none';
        show('signin');
      }
    })
    .withFailureHandler(function () {
      try { localStorage.removeItem('sid'); } catch(_) {}
      var lo = document.getElementById('btn-logout'); if (lo) lo.style.display = 'none';
      show('signin');
    })
    .validateSession(sid);

  setTimeout(function(){
    try {
      var vm = document.getElementById('view-member');
      var vs = document.getElementById('view-signin');
      var vmVisible = (vm && !vm.classList.contains('hidden'));
      var vsVisible = (vs && !vs.classList.contains('hidden'));
      if (!vmVisible && !vsVisible) {
        try { localStorage.removeItem('sid'); } catch(_) {}
        var lo = document.getElementById('btn-logout'); if (lo) lo.style.display = 'none';
        show('signin');
      }
    } catch(_) {}
  }, 8000);
})();
setTimeout(function(){
  try {
    var logoutBtn = document.getElementById('btn-logout');
    var loggedIn = (logoutBtn && logoutBtn.style.display !== 'none');
    var memberView = document.getElementById('view-member');
    var memberVisible = (memberView && !memberView.classList.contains('hidden'));
    if (!loggedIn && !memberVisible) { clearSid(); navigateGuarded_('signin'); }
  } catch(_) {}
}, 8000);
setTimeout(function(){
  try {
    var logoutBtn = document.getElementById('btn-logout');
    var loggedIn = (logoutBtn && logoutBtn.style.display !== 'none');
    var memberView = document.getElementById('view-member');
    var memberVisible = (memberView && !memberView.classList.contains('hidden'));
    if (!loggedIn && !memberVisible) { clearSid(); navigateGuarded_('signin'); }
  } catch(_) {}
}, 8000);
      });
    })();
  </script>
</body>
</html>



